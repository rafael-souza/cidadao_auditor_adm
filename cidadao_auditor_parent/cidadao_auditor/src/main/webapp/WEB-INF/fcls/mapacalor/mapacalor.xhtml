<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:h="http://java.sun.com/jsf/html" 
	xmlns:f="http://java.sun.com/jsf/core" 
	xmlns:ui="http://java.sun.com/jsf/facelets" 
	xmlns:plc="http://www.powerlogic.com.br/plc" 
	xmlns:plcf="http://www.powerlogic.com.br/plcf" 
	xmlns:tr="http://myfaces.apache.org/trinidad" 
	xmlns:p="http://primefaces.org/ui"
	xmlns:trh="http://myfaces.apache.org/trinidad/html">  
	<ui:composition template="/fcls/template/PlcGeralTemplate.xhtml"> 
		<ui:define name="plc-corpo-formulario"> 
			<div id="plc-form-baco"> 
				<div id="#{plcAliasPrefixoAction}Arg" class="plc-form-basico-topo"> 
					<plcf:tabela tituloChave="mapacalorarg.titulo"> 										
						<plcf:linha> 
							<plcf:celula> 
								<plcf:titulo value="#{msg['label.secretaria']}"/>  
								 <plcf:comboDinamico id="secretaria" value="#{mapacalor.secretaria}" 
									dominio="SecretariaEntity" exibeBranco="S" ajudaChave="ajuda.secretaria" />
							</plcf:celula>
							<plcf:celula> 
								<plcf:titulo value="#{msg['label.tipoOcorrencia']}"/>  
								<plcf:comboDinamico id="tipoOcorrencia" value="#{mapacalor.tipoOcorrencia}" dominio="TipoOcorrenciaEntity" exibeBranco="S" ajudaChave="ajuda.tipoOcorrencia"/> 								
							</plcf:celula>  
							<plcf:celula> 							
								<plcf:titulo value="#{msg['label.dataOcorrencia']}"/>  
								<plcf:data id="dataOcorrencia" value="#{mapacalor.dataOcorrencia}" ajudaChave="ajuda.dataOcorrencia"/> 								
							</plcf:celula>  
							<plcf:celula> 								
								<plcf:titulo value="#{msg['label.dataConclusao']}"/>  
								<plcf:data id="dataConclusao" value="#{mapacalor.dataConclusao}" ajudaChave="ajuda.dataConclusao"/> 								
							</plcf:celula>  
							<plcf:celula> 								
								<plcf:titulo value="#{msg['label.statusOcorrencia']}"/>  
								<plcf:comboEstatico id="statusOcorrencia" value="#{mapacalor.statusOcorrencia}" dominio="StatusOcorrencia" exibeBranco="S" ajudaChave="ajuda.statusOcorrencia"/> 								
							</plcf:celula> 

							<plcf:celula> 								
									<plcf:titulo value="#{msg['label.protocolo']}"/>  
									<plcf:texto id="protocolo" value="#{mapacalor.protocolo}" tamanho="20" tamanhoMaximo="100" ajudaChave="ajuda.protocolo"/> 								
							</plcf:celula> 

							<plcf:celula > 								
								<plcf:titulo value="#{msg['label.endereco']}"/>  
								<plcf:texto id="endereco" value="#{mapacalor.endereco}" tamanho="60" tamanhoMaximo="100" ajudaChave="ajuda.endereco"/> 								
							</plcf:celula> 

						</plcf:linha>
						

	

						<!--	<plcf:celula> 
								<plcf:titulo value="Listagem de Ocorrências"/>  							
        						<plcf:caixaMarcacao id="listagemOcorrencia" value="#{plcAction.listagemOcorrencia}" onclick="visualizaListagem()" />		
        					</plcf:celula>				-->

						
					</plcf:tabela> 
					 
					
					<div id="#{plcAliasPrefixoAction}Sel" class="_plc-form-basico-sel"> 
					<fieldset class="plc-fieldset"> 
						<legend class="plc-fieldset-legend">Resultados</legend>  
						<plcf:iteracao var="item" value="#{mapacalorLista.itensPlc}" styleClass="plc-table-tabsel delimitador tabelaFormulario plc-table-seljsf" columnClasses="celulaFormulario" headerClass="celulaFormulario"> 
							<h:column> 
								<f:facet name="header"> 
									<span class="plc-title af_outputLabel"> 
										<h:outputText value="#{msg['label.id']}"/> 
									</span> 
								</f:facet>  
								<plcf:exibe value="#{item.id}" classeCSS="idItem">id</plcf:exibe> 
							</h:column>  
							<h:column> 
								<f:facet name="header"> 
									<span class="plc-title af_outputLabel"> 
										<h:outputText value="#{msg['label.tipoOcorrencia']}"/> 
									</span> 
								</f:facet>  
								<plcf:exibe value="#{item.tipoOcorrencia}">tipoOcorrencia</plcf:exibe> 
							</h:column>  
							<h:column> 
								<f:facet name="header"> 
									<span class="plc-title af_outputLabel"> 
										<h:outputText value="#{msg['label.dataOcorrencia']}"/> 
									</span> 
								</f:facet>  
								<plcf:exibe value="#{item.dataOcorrencia}">dataOcorrencia</plcf:exibe> 
							</h:column>  
						
							<h:column> 
								<f:facet name="header"> 
									<span class="plc-title af_outputLabel"> 
										<h:outputText value="#{msg['label.statusOcorrencia']}"/> 
									</span> 
								</f:facet>  
								<plcf:exibe value="#{item.statusOcorrencia}">statusOcorrencia</plcf:exibe> 
							</h:column>  
							<h:column> 
								<f:facet name="header"> 
									<span class="plc-title af_outputLabel"> 
										<h:outputText value="#{msg['label.protocolo']}"/> 
									</span> 
								</f:facet>  
								<plcf:exibe value="#{item.protocolo}">protocolo</plcf:exibe> 
							</h:column>  

							<h:column> 
								<f:facet name="header"> 
									<span class="plc-title af_outputLabel"> 
										<h:outputText value="#{msg['label.pessoa']}"/> 
									</span> 
								</f:facet>  
								<plcf:exibe value="#{item.pessoa}">pessoa</plcf:exibe> 
							</h:column>
							<h:column> 
								<f:facet name="header"> 
									<span class="plc-title af_outputLabel"> 
										<h:outputText value="#{msg['label.endereco']}"/> 
									</span> 
								</f:facet>  
								<plcf:exibe value="#{item.endereco}">endereco</plcf:exibe> 
							</h:column> 							  
							 
							<h:column> 
								<f:facet name="header"> 
									<span class="plc-title af_outputLabel"> 
										<h:outputText value="#{msg['label.dataConclusao']}"/> 
									</span> 
								</f:facet>  
								<plcf:exibe value="#{item.dataConclusao}">dataConclusao</plcf:exibe> 
							</h:column>  

							<h:column> 
								<f:facet name="header"> 
									<span class="plc-title af_outputLabel"> 
										<h:outputText value="#{msg['label.responsavelConclusao']}"/> 
									</span> 
								</f:facet>  
								<plcf:exibe value="#{item.responsavelConclusao}">responsavelConclusao</plcf:exibe> 
							</h:column> 
							<h:column> 
								<f:facet name="header"> 
									<span class="plc-title af_outputLabel"> 
										<h:outputText value="#{msg['label.latitude']}"/> 
									</span> 
								</f:facet>  
								<plcf:exibe value="#{item.latitude}">latitude</plcf:exibe> 
							</h:column> 
							<h:column> 
								<f:facet name="header"> 
									<span class="plc-title af_outputLabel"> 
										<h:outputText value="#{msg['label.longitude']}"/> 
									</span> 
								</f:facet>  
								<plcf:exibe value="#{item.longitude}">longitude</plcf:exibe> 
							</h:column> 
							<h:column> 	
								<f:facet name="header"> 
									<span class="plc-title af_outputLabel"> 
										<h:outputText value="#{msg['label.observacao']}"/> 
									</span> 
								</f:facet>  
								<plcf:exibe value="#{item.observacao}">observacao</plcf:exibe> 
							</h:column>		
							<h:column> 	
								<f:facet name="header"> 
									<span class="plc-title af_outputLabel"> 
										<h:outputText value="Foto"/> 
									</span> 
								</f:facet>  

								<img src='#{item.conteudoBinarioFoto}' height="115" width="83"/>								
							</h:column>	

							<h:column styleClass="escondido"> 	
								<f:facet name="header"> 
									<span class="plc-title af_outputLabel"> 
										<h:outputText value="FotoConteudo"/> 
									</span> 
								</f:facet>  

								<plcf:exibe value='#{item.conteudoBinarioFoto}'/>								
							</h:column>								


												
							
						</plcf:iteracao> 
					</fieldset>  
						<script>createLineSelection('#{request.contextPath}/f/n/ocorrenciaman');</script> 
					</div> 		
				</div>				

				<fieldset class="plc-fieldset plc-fieldset-embutido">
					<legend class="plc-fieldset-legend">Mapa de Ocorrências</legend>
					<plcf:tabela>
						<plcf:linha> 
							<plcf:celula columnSpan="5" inlineStyle="padding-left: 1%;">	
								<center>
									<div id="mapa" style="height: 500px; width: 1200px"></div>
    								<div id="legend"></div>
    							</center>
							</plcf:celula>
						</plcf:linha>
					</plcf:tabela> 
				</fieldset> 


			</div>
		<script type="text/javascript">//<![CDATA[

			var map;
			 
			function initialize() {				
			    var latlng = new google.maps.LatLng(#{plcAction.latitude}, #{plcAction.longitude});
			 
			    var options = {
			        zoom: 13,
			        center: latlng,
			        mapTypeId: google.maps.MapTypeId.ROADMAP
			    };
			 
			    map = new google.maps.Map(document.getElementById("mapa"), options);

			    montaMapaCalor();
			}
			 
			initialize();

			function montaMapaCalor(){
				var heatMapData = [];
			    var listaOcorrencias = plc.jq('#corpo\\:formulario\\:item').tableToJSON();
			    //listaOcorrencias = JSON.stringify({ ocorrencia: listaOcorrencias });			    	
			    if (listaOcorrencias.length > 0) {  
			    	for (i = 0; i < listaOcorrencias.length; i++) {     
                                                                 		    				       
			            var ocorrencia = listaOcorrencias[i];

			    		var latlong = new google.maps.LatLng(ocorrencia.Latitude, ocorrencia.Longitude);	
			    		heatMapData.push(latlong);             
			        }
			    	var heatmap = new google.maps.visualization.HeatmapLayer({
			    		  data: heatMapData
			    		});
			    	heatmap.setMap(map);
        					        
			    }
			}			


	        function aposSelecaoModal(data) {
	            var status = data.status;
	            switch (status) {
	                case "success":
	                    var optsSel = {
	        				$tabela: plc.jq("table#"+prefixForm+'#{plcAliasPrefixoAction}')
	        				,urlEdicao:'#{request.contextPath}/f/n/ocorrenciaman'
	        				,numPorPagina: 50
	            			,propAgregada: 'mapacalor'
	            			,nomePropAgregada: "nome"
	            			,paramEdicao: "id"
	        				,modoJanelaPlc:'${param.modoJanelaPlc}'
	                	}
						montarSelecaoSemGrid(optsSel);
	                break;
	            }
	        }

	        // Setup the statusUpdate function to hear all events on the page
	        jsf.ajax.addOnEvent(aposSelecaoModal);

	        function visualizaListagem(){
	        	if (plc.jq('#mapacalorSel').is(":visible") == true){
	        		plc.jq('#mapacalorSel').hide();	
	        	} else {
	        		plc.jq('#mapacalorSel').show();	
	        	}
	        }	

			plc.jq('#mapacalorSel').hide();	
			plc.jq('.escondido').hide();
	        plc.jq('#corpo\\:formulario\\:listagemOcorrencia').prop('checked', false);
        
		//]]> </script>  
			<div id="#{plcAliasPrefixoAction}Nav" class="plc-navegacao"> 
				<ui:include src="/WEB-INF/fcls-plc/geralPaginacaoLogicaItens.xhtml"/> 
			</div> 			
		</ui:define>
	</ui:composition> 
</html>
